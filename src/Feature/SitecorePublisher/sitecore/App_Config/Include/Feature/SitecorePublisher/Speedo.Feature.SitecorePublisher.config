<configuration xmlns:patch="http://www.sitecore.net/xmlconfig/">
    <sitecore>
        <events>
            <event name="publish:complete">
                <handler type="Speedo.Feature.SitecorePublisher.Events.PublishCompleteHandler, Speedo.Feature.SitecorePublisher" method="RunUpdateStoragePipeline" />
            </event>
        </events>
        <pipelines>
            <group groupName="speedo">
                <pipelines>
                    <updatestorage>
                        <processor type="Speedo.Feature.SitecorePublisher.Storage.FileSystem.Pipelines.UpdateStorage.AbortOnNoChanges, Speedo.Feature.SitecorePublisher"  />
                        <processor type="Speedo.Feature.SitecorePublisher.Storage.FileSystem.Pipelines.UpdateStorage.SaveSnapshot, Speedo.Feature.SitecorePublisher" resolve="true" />
                    </updatestorage>
                </pipelines>
            </group>
        </pipelines>

        <layoutService>
            <configurations>
                <config name="default">
                    <rendering>
                        <itemSerializer type="Sitecore.LayoutService.Serialization.ItemSerializers.DefaultItemSerializer, Sitecore.LayoutService">
                            <patch:attribute name="type" value="Speedo.Feature.SitecorePublisher.OutOfHttpContextItemSerializer, Speedo.Feature.SitecorePublisher" />
                        </itemSerializer>
                    </rendering>
                </config>
            </configurations>
        </layoutService>
    </sitecore>
</configuration>